<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Question-Answering Chatbot</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/qna"></script>
  <style>
    #progress-container {
      width: 100%;
      height: 20px;
      background-color: #ddd;
    }
    #progress-bar {
      width: 0;
      height: 100%;
      background-color: #4caf50;
      text-align: center;
      transition: width 0.2s;
    }
    #loading {
      display: none;
    }
    #chat-container {
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }
    .chat-bubble {
      padding: 10px;
      border-radius: 10px;
      margin: 5px 0;
    }
    .chat-bubble.you {
      background-color: #e1f5fe;
    }
    .chat-bubble.chatbot {
      background-color: #c8e6c9;
    }
    .chat-controls {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Question-Answering Chatbot</h1>
  
  <!-- Progress bar to indicate model loading status -->
  <div id="progress-container">
    <div id="progress-bar">Load Model</div>
  </div>
  
  <div id="chat-container">
    <!-- Chat messages will be displayed here -->
  </div>

  <div class="chat-controls">
    <!-- User input field for questions -->
    <input type="text" id="user-input" placeholder="Ask a question..." disabled>
    <!-- Button to initiate a question -->
    <button id="ask-button" disabled>Ask</button>
    <!-- Button to reset the chat -->
    <button id="reset-chat">Reset</button>
    <!-- Button to load the model -->
    <button id="load-model">Load Model</button>
  </div>

  <!-- Dropdown for model selection -->
  <label for="model-select">Choose Model:</label>
  <select id="model-select" disabled>
    <option value="bert">BERT</option>
    <option value="roberta">RoBERTa</option>
    <option value="albert">ALBERT</option>
    <option value="gpt3">GPT-3.5</option>
  </select>

  <script>
    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");
    const progressBar = document.getElementById("progress-bar");
    const loadingIndicator = document.getElementById("loading");
    const askButton = document.getElementById("ask-button");
    const resetChatButton = document.getElementById("reset-chat");
    const loadModelButton = document.getElementById("load-model");
    const modelSelect = document.getElementById("model-select");

    let bertModel = null;
    let currentModel = "bert"; // Default model

    // Load the model based on user interaction
    async function loadModel() {
      loadingIndicator.style.display = 'block';
      progressBar.style.width = '0'; // Reset progress
      try {
        switch (currentModel) {
          case 'bert':
            bertModel = await qna.load();
            break;
          case 'roberta':
          case 'albert':
            // Load these models from other sources
            console.error("Model not implemented."); // Placeholder
            break;
          case 'gpt3':
            // GPT-3.5 requires API integration, not TensorFlow
            console.error("Requires external API.");
            break;
          default:
            console.error("Unknown model.");
        }
        progressBar.style.width = '100%';
      } catch (error) {
        console.error("Error loading model:", error);
        chatContainer.appendChild(document.createElement("div")).textContent = "Chatbot: Model loading failed.";
      } finally {
        loadingIndicator.style.display = 'none';
        userInput.disabled = false; // Enable the input field after loading
        askButton.disabled = false; // Enable the ask button
        modelSelect.disabled = false; // Enable the model selection
      }
    }

    async function askQuestion() {
      const question = userInput.value.trim();
      if (question === "") return;

      const questionDiv = document.createElement("div");
      questionDiv.className = "chat-bubble you";
      questionDiv.textContent = "You: " + question;
      chatContainer.appendChild(questionDiv);

      const answer = await getAnswer(question);

      const answerDiv = document.createElement("div");
      answerDiv.className = "chat-bubble chatbot";
      answerDiv.textContent = "Chatbot: " + answer;
      chatContainer.appendChild(answerDiv);

      userInput.value = ""; // Clear the input field
      chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
    }

    async function getAnswer(question) {
      if (!bertModel) {
        await loadModel();
      }

      const context = "Your context or document for BERT to find answers."; // Modify as needed
      const answers = await bertModel.findAnswers(question, context);

      const topAnswer = answers.length > 0 ? answers[0].text : "I need more information.";

      return topAnswer;
    }

    askButton.addEventListener("click", askQuestion);
    
    loadModelButton.addEventListener("click", loadModel); // Load model on button click

    resetChatButton.addEventListener("click", () => {
      chatContainer.innerHTML = ""; // Clear chat history
      userInput.disabled = true; // Disable input
      askButton.disabled = true; // Disable ask button
      modelSelect.disabled = true; // Disable model selection
    });
  </script>
</body>
</html>
