<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BERT Question-Answering Chatbot</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/qna"></script>
  <style>
    #progress-container {
      width: 100%;
      height: 20px;
      background-color: #ddd;
    }
    #progress-bar {
      width: 0;
      height: 100%;
      background-color: #4caf50;
      text-align: center;
      color: white;
      transition: width 0.2s; /* Smooth transition for the progress bar */
    }
    #loading {
      display: none;
    }
    #chat-container {
      padding: 10px;
    }
    .chat-bubble {
      padding: 10px;
      border-radius: 10px;
      margin: 5px 0;
    }
    .chat-bubble.you {
      background-color: #e1f5fe;
    }
    .chat-bubble.chatbot {
      background-color: #c8e6c9;
    }
  </style>
</head>
<body>
  <h1>BERT Question-Answering Chatbot</h1>
  <!-- Progress bar to indicate model loading status -->
  <div id="progress-container">
    <div id="progress-bar">Loading...</div>
  </div>

  <!-- Chat container for displaying chatbot interaction -->
  <div id="chat-container">
    <!-- Chat messages will be displayed here -->
  </div>

  <!-- User input field for questions -->
  <input type="text" id="user-input" placeholder="Ask a question...">
  <button id="ask-button">Ask</button> <!-- Button to initiate a question -->

  <!-- Loading spinner or text for visual feedback during loading -->
  <div id="loading">Loading...</div>

  <script>
    const chatContainer = document.getElementById("chat-container");
    const userInput = document.getElementById("user-input");
    const progressBar = document.getElementById("progress-bar");
    const loadingIndicator = document.getElementById("loading");
    const askButton = document.getElementById("ask-button");

    let bertModel = null;

    // Initialize the model with a progress bar
    async function loadModel() {
      loadingIndicator.style.display = 'block';
      try {
        bertModel = await qna.load(); // Load the BERT Q&A model
        progressBar.style.width = '100%'; // Set progress to 100% when loaded
      } catch (error) {
        console.error("Error loading model:", error);
        chatContainer.appendChild(document.createElement("div")).textContent = "Chatbot: Model loading failed. Please try again later.";
      } finally {
        loadingIndicator.style.display = 'none';
      }
    }

    // Ask a question and get an answer from the BERT model
    async function askQuestion() {
      const question = userInput.value.trim();
      if (!question) return;

      // Display the user's question
      const questionDiv = document.createElement("div");
      questionDiv.className = "chat-bubble you";
      questionDiv.textContent = "You: " + question;
      chatContainer.appendChild(questionDiv);

      // Get the answer from the BERT model
      const answer = await getAnswer(question);

      // Display the chatbot's answer
      const answerDiv = document.createElement("div");
      answerDiv.className = "chat-bubble chatbot";
      answerDiv.textContent = "Chatbot: " + answer;
      chatContainer.appendChild(answerDiv);

      userInput.value = ""; // Clear the input field after asking a question
      chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
    }

    // Get an answer from the BERT model
    async function getAnswer(question) {
      if (!bertModel) { // Load the model if not already loaded
        await loadModel(); 
      }

      const context = "Your context or document for BERT to find answers."; // Modify as needed
      const answers = await bertModel.findAnswers(question, context); // Get answers from the model

      const topAnswer = answers.length > 0 ? answers[0].text : "I'm not sure, but I'll find out."; // Provide more personalized feedback

      return topAnswer;
    }

    // Event listener for the 'Ask' button
    askButton.addEventListener("click", askQuestion);

    // Load the model on startup
    window.onload = loadModel;
  </script>
</body>
</html>
